
    Плагин "autotools", версия 1.2

    к Novik-овской веб-морде для rTorrent
    (http://wl500g.info/showthread.php?t=14256)

    Автор плагина: Романовский Дмитрий (dmrom)

    Функции плагина:
1. "AutoLabel" : автоматическое формирование меток при добавлении нового 
                 торрента через веб-морду.
2. "AutoMove"  : автоматическое перенесение файлов торрента в другой каталог 
                 после полного завершения закачки.

-------------------------------------------------------------------------------
"AutoLabel"
-------------------------------------------------------------------------------
    Метка автоматически формируется, если:
- поле ввода метки в диалоге добавления торрента пустое,
- место, куда предполагается сохранять данные торрента является подкаталогом
  для каталога, указанного в переменной "directory" файла rtorrent.rc.

    Принцип формирования метки:
    Если в rtorrent.rc задана переменная "directory = /usr/p2p/downloads"
и новый торрент сохраняется в /usr/p2p/downloads/Video/DVD/movie.avi,
то в качестве метки подставится "Video/DVD".

-------------------------------------------------------------------------------
"AutoMove"
-------------------------------------------------------------------------------
    Скачанные файлы торрента переносятся в каталог, указаный в конфигурации,
с сохранением структуры каталогов относительно директории, указанной в
переменной "directory" файла "rtorrent.rc" и уже оттуда запускаются на раздачу.

    Например:
    Если в rtorrent.rc задана переменная "directory = /usr/p2p/downloads",
а в качестве каталога для готовых закачек указан каталог "/media/p2p",
то файлы загружавшиеся в "/usr/p2p/downloads/Video/Movie/*.avi" будут 
перемещены в "/media/p2p/Video/Movie/*.avi" после завершения закачки.

    Планировалось применять плагин в случае, когда в качестве каталога для
готовых закачек монтируется другой диск или SMB ресурс с общим доступом.
Данное решение работает на FreeBSD, но, по мнению Novik, "под ядром 2.4
(какое имеет место быть, например, на роутере), раздача с smb и nfs
монтированных разделов идти не будет. Вызов mmap, который используется 
rtorrent на данных fs под данным ядром не работает".

    Плагин корректно обрабатывает ситуацию, когда файлы разных торрентов
сохраняются в один каталог - делается перенос файлов по списку торрента,
а не просто перенос базового каталога.

    Если в каталоге для загруженных файлов окажутся файлы с такими же именами,
как у завершившегося торрента, то они будут перезаписаны.

    Плагин встраивается в rTorrent при загрузке веб-морды. Если, при неактивной
веб-морде, произойдет рестарт rTorrent-а, то плагин не переподключится. Если 
хочется избежать этого, то нужно в конфигурации rtorrent.rc прописать примерно
следующее (в одну строчку):

system.method.set_key = event.download.finished,automove,
    "execute={full_path_to_plugins/autotools/move.sh,full_path_to_php,$d.get_hash=}"

имя события нужно оставить таким же ("automove"), иначе при запуске веб-морды
установится вторая копия обработчика.

    Для удобства выбора каталога для завершенных закачек на хосте рекомендуется
установить сервисный плагин _getdir
http://wl500g.info/showpost.php?p=150424&postcount=2314
(появится возможность навигации по файловой системе хоста)


-------------------------------------------------------------------------------
История версий:
-------------------------------------------------------------------------------

    1.3
    - исправлена ошибка, приводившая к вылету rTorrent, если в именах подкаталогов
      торрента использовались служебные символы, типа ", ` и т.п.
    - попытка избежать лишнего рехэширования, которое иногда возникает.

    1.2
    - плагин переименован в autotools и объединен с automove 1.0
    - добавлена возможность устанавливать настройки в опциях веб-морды

    1.1
    - обеспечение совместимости с плагинами retrackers и edit
    - плагин теперь запускается до retracker (runlevel.info: 5)

    1.0
    - первая версия

